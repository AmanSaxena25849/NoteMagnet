{% extends "base.html" %}

{% block head %}
  {% load static %}
  <link rel="stylesheet" href="{% static "notes/view_note/view_note.css" %}">
  <script defer src="{% static "notes/view_note/view_note.js" %}"></script>
{% endblock head %}

{% block main %}
  <main>
    <div class="note-container">
      <!-- Note Header -->
      <div class="note-header">
        <h1 class="note-title">{{note.title}}</h1>
        <div class="note-meta">
          <div class="author-info">
            <img src="{{note.author.profile_image.url}}" alt="Author Avatar" class="author-avatar">
            <div class="author-details">
              <span class="author-name">{{note.author.first_name}} {{note.author.last_name}}</span>
              <span class="publication-date">Published on {{note.created_at}}</span>
            </div>
          </div>
          {% if user.is_authenticated %}
            {% if user == note.author %}

              <div class="action-buttons">
                <a href="{% url "edit_note" note.id %}" class="edit-btn"> Edit Note </a>
                <button id="delete-btn" class="delete-btn">Delete Note</button>
              </div>

              <div class="delete-form">
                <div class="heading-pera">
                  <h1>Deleting Note: </h1>
                  <p>How to Master Time Management</p>
                </div>
                <div class="warning-pera">
                  <h3>Warning: </h3>
                  <p>Once deleted note can not be recoverd.</p>
                </div>
                
                <div class="btns">
                  <button class="cancel-btn">Cancel</button>
                  <form action="{% url "delete_note" %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="note_id" value="{{ note.id }}">
                    <button  class="delete-btn" type="submit">Delete</button>
                  </form>
                </div>
              </div>
            {% else %}
              <div class="action-buttons">
                <button class="follow-btn">
                  <span class="button-icon">+</span> Follow
                </button>
                {% if note in user.bookmark.all %}
                <form action="{% url "remove_bookmark" note.id %}" 
                        method="post">
                        {% csrf_token %}
                  <button class="star-btn active">
                    <span class="button-icon">★</span> Bookmarked
                  </button>
                </form>
                {% else %}
                  <form action="{% url "bookmark" note.id %}" 
                        method="post">
                    {% csrf_token %}
                    <button class="star-btn">
                      <span class="button-icon">★</span> Add to Bookmark
                    </button>
                  </form>
                {% endif %}
                
              </div>
            {% endif %}
          {% else %}
          <div class="action-buttons">
            <a href="{% url 'account_login' %}" class="follow-btn">Sign in to Follow</a>
          </div>
          {% endif %}
        </div>
      </div>
      
      <img src="{{note.note_image.url}}" alt="Time Management" class="note-cover-img">
      
      <!-- Note Content -->
      <div class="note-body">
        {{note.content}}
        
        <div class="note-footer">
          <div class="note-tags">
            {% for tag in note.tag.all %}
              <span class="tag">{{tag.tag_name}}</span>
            {% endfor %}
          </div>
          <div class="note-stats">
            <div class="note-stat">
              <i class="fas fa-eye"></i> {{note.views_count.count}}
            </div>
            <div class="note-stat">
              <i class="fas fa-heart"></i> {{note.User.count}}
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Related Notes Section -->
    <section class="related-notes">
      <div class="note-container">
        <h2>Related Notes</h2>
        <div class="related-cards">
          <!-- Related Note 1 -->
          {% for related_note in related_notes %}
            <div class="note-card">
              <img src="{{related_note.note_image.url}}" alt="Note Image" class="note-img">
              <div class="note-content">
                <h3 class="note-title">{{related_note.title}}</h3>
                <p class="note-desc">{{related_note.content|truncatechars:150}}</p>
                <div class="note-meta">
                  <div class="user-info">
                    <img src="{{related_note.author.profile_image.url}}" alt="User Avatar" class="user-avatar">
                    <span>{{related_note.author.username }}</span>
                  </div>
                  <span>{{related_note.created_at}}</span>
                </div>
                <a href="{% url "view_note" related_note.id %}" class="read-more">Read More</a>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>
  </main>
  
{% endblock main %}